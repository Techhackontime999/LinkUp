{% extends "admin/base_site.html" %}
{% load i18n admin_urls static %}

{% block breadcrumbs %}
<div class="breadcrumbs">
<a href="{% url 'admin:index' %}">{% trans 'Home' %}</a>
&rsaquo; <a href="{% url 'admin:seed_test_data' %}">Seed Test Data</a>
</div>
{% endblock %}

{% block content %}
<div id="content-main">
    <div class="module">
        <h1>üå± Seed Test Data</h1>
        <p>Generate realistic test data for your LinkUp application. This will create users, posts, jobs, and other content to make your site look active and professional.</p>
        
        <form method="post" id="seed-form">
            {% csrf_token %}
            
            <div class="form-row">
                <div class="form-group">
                    <label for="id_users">Number of Users:</label>
                    <input type="number" name="users" id="id_users" value="{{ users }}" min="1" max="500" class="form-control">
                    <small class="form-text">Creates user profiles with avatars, experience, and education</small>
                </div>
                
                <div class="form-group">
                    <label for="id_posts">Number of Posts:</label>
                    <input type="number" name="posts" id="id_posts" value="{{ posts }}" min="1" max="1000" class="form-control">
                    <small class="form-text">Creates professional posts with images (30% will have images)</small>
                </div>
                
                <div class="form-group">
                    <label for="id_jobs">Number of Jobs:</label>
                    <input type="number" name="jobs" id="id_jobs" value="{{ jobs }}" min="1" max="100" class="form-control">
                    <small class="form-text">Creates realistic job postings with requirements</small>
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label>
                        <input type="checkbox" name="clean" id="id_clean">
                        Clean existing test data before seeding
                    </label>
                    <small class="form-text text-warning">‚ö†Ô∏è This will delete all existing test data (except staff accounts)</small>
                </div>
            </div>
            
            <div class="submit-row">
                <button type="submit" class="default" id="seed-button">
                    üå± Seed Test Data
                </button>
                <button type="button" class="button" id="stats-button">
                    üìä View Current Stats
                </button>
            </div>
        </form>
        
        <!-- Progress indicator -->
        <div id="progress-container" style="display: none; margin-top: 20px;">
            <div class="progress">
                <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 100%">
                    Seeding test data... Please wait...
                </div>
            </div>
            <div id="progress-output" style="margin-top: 10px; padding: 10px; background: #f8f9fa; border-radius: 4px; font-family: monospace; font-size: 12px; max-height: 200px; overflow-y: auto;"></div>
        </div>
        
        <!-- Stats display -->
        <div id="stats-container" style="display: none; margin-top: 20px;">
            <h3>üìä Current Test Data Statistics</h3>
            <div id="stats-content"></div>
        </div>
    </div>
    
    <div class="module">
        <h2>üéØ Quick Presets</h2>
        <div class="form-row">
            <button type="button" class="button preset-btn" data-users="20" data-posts="50" data-jobs="5">
                üè† Small Demo (20 users, 50 posts, 5 jobs)
            </button>
            <button type="button" class="button preset-btn" data-users="50" data-posts="200" data-jobs="20">
                üé¨ Video Recording (50 users, 200 posts, 20 jobs)
            </button>
            <button type="button" class="button preset-btn" data-users="100" data-posts="500" data-jobs="50">
                üöÄ Large Dataset (100 users, 500 posts, 50 jobs)
            </button>
        </div>
    </div>
    
    <div class="module">
        <h2>üìù What Gets Created</h2>
        <ul>
            <li><strong>Users:</strong> Professional profiles with avatars, work experience, education</li>
            <li><strong>Posts:</strong> LinkedIn-style posts with hashtags and images (30% have images)</li>
            <li><strong>Jobs:</strong> Realistic job postings with requirements and salary ranges</li>
            <li><strong>Connections:</strong> Network connections between users</li>
            <li><strong>Follows:</strong> User follows for professional networking</li>
            <li><strong>Comments:</strong> Professional comments on posts</li>
            <li><strong>Likes:</strong> Post engagement through likes</li>
            <li><strong>Messages:</strong> Private messages between users</li>
            <li><strong>Applications:</strong> Job applications with different statuses</li>
        </ul>
    </div>
</div>

<style>
.form-row {
    display: flex;
    gap: 20px;
    margin-bottom: 20px;
    flex-wrap: wrap;
}

.form-group {
    flex: 1;
    min-width: 200px;
}

.form-group label {
    display: block;
    margin-bottom: 5px;
    font-weight: bold;
}

.form-control {
    width: 100%;
    padding: 8px;
    border: 1px solid #ddd;
    border-radius: 4px;
}

.form-text {
    font-size: 12px;
    color: #666;
    margin-top: 5px;
    display: block;
}

.text-warning {
    color: #856404 !important;
}

.submit-row {
    margin-top: 20px;
    padding-top: 20px;
    border-top: 1px solid #eee;
}

.submit-row button {
    margin-right: 10px;
    padding: 10px 20px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
}

.submit-row .default {
    background: #79aec8;
    color: white;
}

.submit-row .button {
    background: #f8f9fa;
    color: #333;
    border: 1px solid #ddd;
}

.preset-btn {
    margin: 5px;
    padding: 10px 15px;
    background: #e3e3e3;
    border: 1px solid #ccc;
    border-radius: 4px;
    cursor: pointer;
}

.preset-btn:hover {
    background: #d3d3d3;
}

.progress {
    height: 20px;
    background-color: #e9ecef;
    border-radius: 4px;
    overflow: hidden;
}

.progress-bar {
    background-color: #007bff;
    color: white;
    text-align: center;
    line-height: 20px;
}

.progress-bar-striped {
    background-image: linear-gradient(45deg, rgba(255,255,255,.15) 25%, transparent 25%, transparent 50%, rgba(255,255,255,.15) 50%, rgba(255,255,255,.15) 75%, transparent 75%, transparent);
    background-size: 1rem 1rem;
}

.progress-bar-animated {
    animation: progress-bar-stripes 1s linear infinite;
}

@keyframes progress-bar-stripes {
    0% { background-position-x: 1rem; }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const seedForm = document.getElementById('seed-form');
    const seedButton = document.getElementById('seed-button');
    const statsButton = document.getElementById('stats-button');
    const progressContainer = document.getElementById('progress-container');
    const progressOutput = document.getElementById('progress-output');
    const statsContainer = document.getElementById('stats-container');
    const statsContent = document.getElementById('stats-content');
    
    // Preset buttons
    document.querySelectorAll('.preset-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            document.getElementById('id_users').value = this.dataset.users;
            document.getElementById('id_posts').value = this.dataset.posts;
            document.getElementById('id_jobs').value = this.dataset.jobs;
        });
    });
    
    // Stats button
    statsButton.addEventListener('click', function() {
        fetch('/admin/test-data-stats/')
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    const stats = data.stats;
                    statsContent.innerHTML = `
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                            <div><strong>Users:</strong> ${stats.users}</div>
                            <div><strong>Posts:</strong> ${stats.posts}</div>
                            <div><strong>Comments:</strong> ${stats.comments}</div>
                            <div><strong>Jobs:</strong> ${stats.jobs}</div>
                            <div><strong>Applications:</strong> ${stats.applications}</div>
                            <div><strong>Connections:</strong> ${stats.connections}</div>
                            <div><strong>Follows:</strong> ${stats.follows}</div>
                            <div><strong>Messages:</strong> ${stats.messages}</div>
                            <div><strong>Notifications:</strong> ${stats.notifications}</div>
                            <div><strong>Experiences:</strong> ${stats.experiences}</div>
                            <div><strong>Educations:</strong> ${stats.educations}</div>
                        </div>
                    `;
                    statsContainer.style.display = 'block';
                } else {
                    alert('Error loading stats: ' + data.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error loading stats');
            });
    });
    
    // Form submission
    seedForm.addEventListener('submit', function(e) {
        e.preventDefault();
        
        if (!confirm('Are you sure you want to seed test data? This may take a few minutes.')) {
            return;
        }
        
        const formData = new FormData(seedForm);
        
        // Show progress
        progressContainer.style.display = 'block';
        progressOutput.textContent = 'Starting data seeding...\n';
        seedButton.disabled = true;
        
        fetch(seedForm.action, {
            method: 'POST',
            body: formData,
            headers: {
                'X-Requested-With': 'XMLHttpRequest',
                'X-CSRFToken': formData.get('csrfmiddlewaretoken')
            }
        })
        .then(response => response.json())
        .then(data => {
            progressOutput.textContent += '\n' + (data.output || data.message);
            
            if (data.success) {
                progressOutput.innerHTML += '\n\n‚úÖ <strong>Success!</strong> Redirecting...';
                setTimeout(() => {
                    window.location.href = '/admin/';
                }, 2000);
            } else {
                progressOutput.innerHTML += '\n\n‚ùå <strong>Error:</strong> ' + data.message;
                seedButton.disabled = false;
            }
        })
        .catch(error => {
            console.error('Error:', error);
            progressOutput.innerHTML += '\n\n‚ùå <strong>Error:</strong> ' + error.message;
            seedButton.disabled = false;
        });
    });
});
</script>
{% endblock %}
